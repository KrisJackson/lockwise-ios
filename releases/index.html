<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Release Instructions - Firefox Lockwise for iOS</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Release Instructions";
    var mkdocs_page_input_path = "releases.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Firefox Lockwise for iOS</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Introduction</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../release-notes/">Release Notes</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">How to Contribute</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../contributing/">Contributing</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../metrics/">Telemetry and Metrics</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Developer Guides</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../install/">Build and Install</a>
                </li>
                <li class="">
                    
    <a class="" href="../architecture/">Architecture</a>
                </li>
                <li class="">
                    
    <a class="" href="../updating_libraries/">Dependencies</a>
                </li>
                <li class="">
                    
    <a class="" href="../add-a-browser/">How to: add a browser</a>
                </li>
                <li class="">
                    
    <a class="" href="../new-ui/">How to: add a UI feature</a>
                </li>
                <li class="">
                    
    <a class="" href="../test-plan/">Test Plan</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Release Instructions</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#release-instructions">Release Instructions</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#distributing-builds-through-buddybuild-branch-release">Distributing Builds through buddybuild (branch / release)</a></li>
        
            <li><a class="toctree-l4" href="#preparing-a-release-for-testflight-or-app-store">Preparing a Release (for TestFlight or App Store)</a></li>
        
            <li><a class="toctree-l4" href="#distributing-builds-through-testflight-release">Distributing Builds through TestFlight (release)</a></li>
        
            <li><a class="toctree-l4" href="#distributing-through-the-app-store-release">Distributing through the App Store (release)</a></li>
        
            <li><a class="toctree-l4" href="#taking-screenshots-for-new-releases">Taking screenshots for new releases</a></li>
        
            <li><a class="toctree-l4" href="#preparation-before-and-after-a-release">Preparation before and after a release</a></li>
        
        </ul>
    

    </ul>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Firefox Lockwise for iOS</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Developer Guides &raquo;</li>
        
      
    
    <li>Release Instructions</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/mozilla-lockwise/lockwise-ios/edit/master/docs/releases.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="release-instructions">Release Instructions</h1>
<p>Some assumptions:</p>
<ul>
<li><code>master</code> is the default branch and is production-ready</li>
<li>commits made to <code>master</code> are built and pass in <a href="https://dashboard.buddybuild.com/apps/5a0ddb736e19370001034f85">buddybuild</a></li>
<li><code>production</code> is our public release branch and may not match <code>master</code></li>
<li>ideally, <code>production</code> will perfectly reproduce master</li>
<li>but if <code>master</code> is in an un-releasable state, we cherry-pick commits to this branch</li>
<li>this is an exception rather than the preferred maintenance method</li>
<li>all <code>master</code> and <code>production</code> builds are sent to App Store Connect, with the same buddybuild build number</li>
<li>App Store Connect has <a href="https://developer.apple.com/testflight/testers/">"internal" testers</a> (mobile devs, product integrity)</li>
<li>thus, App Store Connect and TestFlight can have <a href="https://developer.apple.com/testflight/testers/">"external" testers</a> which we add manually</li>
<li>currently, no plans exist for "external" users to include anyone outside of Mozilla</li>
</ul>
<h2 id="distributing-builds-through-buddybuild-branch-release">Distributing Builds through buddybuild (branch / release)</h2>
<p><em>all commits on all branches and pull requests are automatically built</em></p>
<ol>
<li>Push to the git branch available on GitHub.com and open a pull request</li>
<li>Open <a href="https://dashboard.buddybuild.com/apps/5a0ddb736e19370001034f85">buddybuild</a> from a mobile device and browse to the build</li>
<li>Alternatively, add an email address to the "Deployments" email list(s)</li>
<li>this is expected to be a small group of contributors and Mozillians</li>
</ol>
<h2 id="preparing-a-release-for-testflight-or-app-store">Preparing a Release (for TestFlight or App Store)</h2>
<ol>
<li>Update the release notes under <code>docs/release-notes.md</code></li>
<li>create a pull request to collaborate and get approval</li>
<li>determine the next build number and include it in release notes</li>
<li>merge the release notes to <code>master</code> branch</li>
<li>this will result in a release build matching the build number provided</li>
<li>Create and merge a pull request <em>from</em> <code>master</code> <em>to</em> <code>production</code> so it tracks the release</li>
<li>https://github.com/mozilla-lockwise/lockwise-ios/compare/production...master</li>
<li>Create a tag from <code>production</code> matching the format: <code>major.minor.patch.build</code></li>
<li>for example: <code>1.2.1399</code> is major version 1.2, (buddybuild) build 1399</li>
<li>for example: <code>1.3.1.1624</code> is major version 1.3 with 1 patch release, (buddybuild) build 1624</li>
<li>push the tag to GitHub and create a corresponding "Release" on GitHub.com</li>
<li>copy the release notes to the "Release" on GitHub</li>
<li>download the <code>.ipa</code> from buddybuild and attach it to the Release on GitHub</li>
<li>Hopefully by now the build has been uploaded to App Store Connect</li>
<li>Browse to App Store Connect and continue the "Distributing..." instructions</li>
<li>Download and unzip dSYM build artifact from buddybuild</li>
<li>Upload dSYM files to Sentry using <code>sentry-cli</code> using <a href="https://docs.sentry.io/clients/cocoa/dsym/#manually-with-sentry-cli">sentry instructions</a></li>
<li>HINT: if you get a 411 "content-length" error, you may need to add the <code>--no-reprocessing</code> flag due to a bug with GCP and the <code>sentry-cli</code></li>
</ol>
<h3 id="in-case-of-emergency-release">In Case of Emergency (Release)</h3>
<p><em>similar to above, but requires explicit cherry-pick commits on <code>production</code> branch when <code>master</code> branch is not in a release-able state</em></p>
<ol>
<li>Merge the emergency changes or fixes or features to default <code>master</code> branch as usual</li>
<li>Update the release notes</li>
<li>Create and merge a pull request <em>up to and including</em> the last release-able commit on <code>master</code> to <code>production</code></li>
<li>Then <code>git cherry-pick</code> each additional commit from <code>master</code> to be included in the release</li>
<li>thus skipping or avoiding the non-release-able commits</li>
<li>Push the resulting <code>production</code> branch to GitHub.com</li>
<li>Create a tag from <code>production</code> matching the format: <code>major.minor.patch.build</code></li>
<li>for example: <code>git tag -a -s 1.3.1.1624 -m "1.3.1 (Build 1624)"</code></li>
<li>Push the tag to GitHub and create a corresponding "Release" on GitHub.com</li>
<li>copy the release notes to the "Release" on GitHub</li>
<li>Browse to buddybuild and find the desired <code>production</code> branch build to distribute</li>
<li>download the <code>.ipa</code> from buddybuild and attach it to the Release on GitHub</li>
<li>From the buddybuild's build "Deploy" tab, select the "Upload to App Store Connect" link</li>
<li>Browse to App Store Connect to find the build and continue the "Distributing..." instructions</li>
</ol>
<p><em>While most reviews are performed and completed within 24 hours, to request an expedited review request you can <a href="https://developer.apple.com/contact/app-store/?topic=expedite">submit a request directly to Apple</a>.</em></p>
<h2 id="distributing-builds-through-testflight-release">Distributing Builds through TestFlight (release)</h2>
<p><em>all <code>master</code> and <code>production</code> branch builds are automatically uploaded from buddybuild to App Store Connect.</em></p>
<p>NOTE: if for some reason buddybuild does not deploy a build to App Store Connect, download the full App Store Connect .ipa from buddybuild and use the "Application Loader" app to manually upload it yourself.</p>
<ol>
<li>Browse to <a href="https://itunesconnect.apple.com/WebObjects/iTunesConnect.woa/ra/ng/app/1314000270/testflight?section=iosbuilds">TestFlight &gt; Builds &gt; iOS</a> in App Store Connect</li>
<li>Find the desired build number to distribute</li>
<li>Provide export compliance responses<blockquote>
<p>Does your app use encryption? Select Yes even if your app only uses the standard encryption in iOS and macOS.  </p>
</blockquote>
</li>
</ol>
<p>Yes</p>
<blockquote>
<p>Does your app qualify for any of the exemptions provided in Category 5, Part 2 of the U.S. Export Administration Regulations?  </p>
</blockquote>
<p>Yes (c) Limited to authentication, digital signature, or the decryption of data or files</p>
<ol>
<li>Once provided, this makes the build immediately available to "internal" App Store Connect users</li>
<li>Copy the release notes for this release and add them to the "Test Details"</li>
<li>Add at least one other "Group" of "external" testers to the build</li>
<li>after review, this will make it available for all those "external" testers</li>
<li>example: "lockbox-dev" which includes our other non-App Store Connect engineers</li>
<li>example: "Product" which includes other product and content Mozillians</li>
<li>example: "Cohort A" which includes the first round of volunteers to test</li>
</ol>
<h2 id="distributing-through-the-app-store-release">Distributing through the App Store (release)</h2>
<p><em>Currently all the mobile engineering managers and release management team members (see private #release-coordination channel in Mozilla Slack) both have access to distribute production releases through the App Store.</em></p>
<ol>
<li>Browse to the <a href="https://itunesconnect.apple.com/WebObjects/iTunesConnect.woa/ra/ng/app/1314000270">App Store</a> section in App Store Connect</li>
<li>Confirm the "App Information" details are accurate and complete</li>
<li>Confirm the "Pricing and Availability" details are accurate and complete</li>
<li>Browse to the "iOS App" section to "Prepare for Submission"</li>
<li>provide the version information (keywords, URLs, promotional screenshots)</li>
<li>select the corresponding build number for the App Store release</li>
<li>set the release instructions (manually, immediately, on a date)</li>
<li>NOTE: the best practice is to opt for the "Phased" release which starts at 1% per day, then 2% up to 100% after 7 days. This way you can "Pause" the release if early use results in new findings or big issues. The app will still be available to users who manually access the App Store "Update" section, though.</li>
<li>Save and "Submit for Review"</li>
</ol>
<p>NOTE: <em>brand new</em> apps may take up to 2 or more hours to appear throughout the App Store whereas existing app (updates) can appear within an hour. Schedule accordingly!</p>
<h2 id="taking-screenshots-for-new-releases">Taking screenshots for new releases</h2>
<p>Screenshots are automated via Fastlane. To get Fastlane, run <code>brew cask install fastlane</code>. From there, you will be able to run <code>fastlane snapshot</code> in the root directory of the project to run the screenshot task.</p>
<p>Configuration:
- [languages] Update / add desired locales to <code>fastlane/Snapfile</code>
- [devices] Update / add desired device sizes to <code>fastlane/Snapfile</code>
- <a href="https://stackoverflow.com/questions/38316591/how-to-test-dynamic-type-larger-font-sizes-in-ios-simulator">text size</a> Update the <code>CONTENT_SIZE</code> variable in <code>LockboxXCUITests/BaseTestCase.swift</code></p>
<h2 id="preparation-before-and-after-a-release">Preparation before and after a release</h2>
<ul>
<li><strong>Before testing or distributing a release</strong>: make sure the release number is still what you want and expect it to be, especially if major (versus minor) changes were made. (see below on how to <em>"change the version"</em>).</li>
<li><strong>Once development is complete</strong>: consider running the string export script to send new and updated strings to Pontoon for localization (see <a href="../localization/">localization.md</a>) </li>
<li><strong>Before public release</strong>: consider running the string import script to get the latest from Pontoon (see <a href="../localization/">localization.md</a>) </li>
<li><strong>After public release</strong>: consider filing an issue for the next sprint/release to update to the latest dependencies (application-services, for example)</li>
<li><strong>After public release</strong>: consider running <code>mkdocs gh-deploy</code> so the latest <code>docs</code> are also published to the GitHub pages website</li>
<li><strong>After public release</strong>: <em>change the version</em> to a major or minor update depending on the future plans.</li>
<li>Update the value in <code>Common/Resources/Info.plist</code> for the Lockbox app, for example from <code>1.2</code> to <code>1.3</code></li>
<li>Also update the value in <code>CredentialProvider/Info.plist</code> for the extension to <em>the exact same version</em></li>
<li><strong>After public release</strong>: make sure the dSYMs were uploaded to Sentry as part of the process earlier, do it now if not so your error reports are symbolicated.</li>
<li><strong>After changing the version</strong>: TestFlight requires manual Beta review before any build is distributed. Be sure to submit a new build to TestFlight Beta App Review as early as possible so that review doesn't prevent user testing.</li>
</ul>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="../test-plan/" class="btn btn-neutral" title="Test Plan"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/mozilla-lockwise/lockwise-ios/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../test-plan/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>

</body>
</html>
